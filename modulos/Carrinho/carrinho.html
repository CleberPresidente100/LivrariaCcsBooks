<html>
    <head>
        <link rel="stylesheet" type="text/css" href="carrinho.css">

        <script type="text/javascript" src="carrinho.js"></script>
        <script type="text/javascript" src="../../js/script.js"></script>
        <script type="text/javascript" src="../../js/cookies.js"></script>
        <script type="text/javascript" src="../../js/conexaoBanco.js"></script>
        <script type="text/javascript" src="../../js/usuarios.js"></script>
    </head>

    

    <body>
        <div class="lista-produtos">
            <div class="lista-produtos2">
                <h5 class="nome-produto">LIVRO</h5>
                <h5 class="preco">PREÃ‡O</h5>
                <h5 class="quantidade">QUANTIDADE</h5>
                <h5 class="total">TOTAL</h5>
            </div>
            <div class="produtos">

            </div>
        </div>
        <input type="submit" onclick="finalizarCompra()" class="finalizar-compra" value="FINALIZAR COMPRA"></input>
        <script>
            function mostrarCarrinho(){
                carregarCarrinho();
                var valorTotal = 0;
                var valorAtual;
                var valorLivro;
                var frete = 9.90;
                let listaProdutos = document.querySelector(".produtos");
                if(produtoCarrinho && listaProdutos){
                    listaProdutos.innerHTML = '';
                    
                    Object.values(produtoCarrinho).map(item => {
                        valorAtual = item.valorLivro * item.quantidade;
                        valorTotal = valorTotal + valorAtual;
                        valorAtual = (Math.round(valorAtual * 100)/100).toFixed(2);
                        valorLivro = item.valorLivro.toFixed(2);
                        listaProdutos.innerHTML += `
                        <div class="livros">
                            <input class="botao" type="image" src="../../imagens/BotaoX.png" height="50" width="50" onClick="removerProduto(id)" id="${item.idLivro}"> </input>
                            <img src="../../capasLivros/${item.idLivro}.jpg" height="170" width="150">
                        </div>
                        <div class="preco">R$${valorLivro}</div>
                        <div class="quantidade">
                            <input class="botao-esquerda" type="image" src="../../imagens/SetaE.png" height="25" width="25" onClick="diminuirProduto(id)" id="${item.idLivro}"> </input>
                            <span>${item.quantidade}</span>
                            <input class="botao-direita" type="image" src="../../imagens/SetaD.png" height="25" width="25" onClick="contadorCarrinho(id)" id="${item.idLivro}"> </input>
                        </div>
                        <div class="total">
                            R$${valorAtual}
                        </div>
                        `
                    });
                    valorTotal = valorTotal + frete;
                    valorTotal = (Math.round(valorTotal * 100)/100).toFixed(2);
                    
                    listaProdutos.innerHTML += `
                    <h3 class="frete">Frete: R$9,90<br></h3>
                    <div class="valor-total"><br><br>Valor total: R$${valorTotal}</div>
                    `
                }

            }
            function finalizarCompra(){
                if(ObterUsuarioLogado()){
                    localStorage.clear();
                    window.location.href = "../CompraFinalizada/CompraFinalizada.html"
                }
                else{
                    alert("Realize login para continuar");
                    window.location.href = "../LoginUsuario/login.html"
               }
            }

            mostrarCarrinho();
        </script>
    </body>
</html>